---
---

<div id="pfp-container" style={`--size: ${Astro.props.size}`}>
  <div id="bg"></div>
  <div id="rect"></div>

  <div id="c1-2" style="grid-area: 1 / 2" class="tri-r"></div>
  <div id="c1-3" style="grid-area: 1 / 3" class="tri-r"></div>
  <div id="c1-4" style="grid-area: 1 / 4" class="tri-l"></div>

  <div id="c2-2" style="grid-area: 2 / 2" class="tri-r"></div>
  <div id="c2-4" style="grid-area: 2 / 4" class="tri-t"></div>

  <div id="c3-2" style="grid-area: 3 / 2" class="tri-r"></div>

  <div id="c4-1" style="grid-area: 4 / 1" class="tri-b"></div>
  <div id="c4-2" style="grid-area: 4 / 2" class="tri-b"></div>
  <div id="c4-3" style="grid-area: 4 / 3" class="tri-b"></div>
  <div id="c4-4" style="grid-area: 4 / 4" class="tri-b"></div>
</div>

<style lang="sass">
  #pfp-container
    display: grid
    height: var(--size)
    width: var(--size)
    grid-template: repeat(4, 1fr) / repeat(4, 1fr)
    flex-shrink: 0

    div
      background: #c2f1ff
    
    #bg
      background: #6db4d5
      width: 0
      grid-area: 1 / 1 / span 4 / span 4
    
  #rect
    height: 0
    grid-area: 1 / 1 / span 4 / 1
  
  .tri-r
    clip-path: polygon(100% 100%, 100% 100%, 100% 0)
  
  .tri-b
    clip-path: polygon(100% 100%, 0 100%, 100% 100%)
  
  .tri-l
    clip-path: polygon(0 0, 0 100%, 0 0)
  
  .tri-t
    clip-path: polygon(0 0, 0 0, 100% 0)
</style>

<noscript>
<style is:inline>
  #bg {
    width: 100% !important;
  }
  #rect {
    height: 75% !important;
  }
  .tri-r, .tri-b {
    clip-path: polygon(100% 100%, 0 100%, 100% 0) !important;
  }
  .tri-l, .tri-t {
    clip-path: polygon(0 0, 0 100%, 100% 0) !important;
  }
</style>
</noscript>

<script>
  import { EASE } from "crossani";

  const $ = document.querySelector.bind(document);
  const $$ = document.querySelectorAll.bind(document);

  const makeTrans = (state) => [
    {
      reset: true,
    },
    {
      state,
      ms: 600,
      easing: EASE.cubicBezier(0.16, 1, 0.3, 1),
    },
  ];

  // SETUP
  $("#bg").transitions = makeTrans({ width: "100%" });
  $("#rect").transitions = makeTrans({ height: "75%" });

  const toBR = { "clip-path": "polygon(100% 100%, 0 100%, 100% 0)" };
  const toTL = { "clip-path": "polygon(0 0, 0 100%, 100% 0)" };

  $$(".tri-r").forEach((e) => (e.transitions = makeTrans(toBR)));
  $$(".tri-b").forEach((e) => (e.transitions = makeTrans(toBR)));
  $$(".tri-t").forEach((e) => (e.transitions = makeTrans(toTL)));
  $$(".tri-l").forEach((e) => (e.transitions = makeTrans(toTL)));

  // ACTUAL TRANSITIONS
  setTimeout(() => {
    $("#bg").doTransition(1);
    
    setTimeout(() => {
      $("#rect").doTransition(1);
      $("#c1-2").doTransition(1);
      $("#c4-1").doTransition(1);
    }, 100);

    setTimeout(() => {
      $("#c1-3").doTransition(1);
      $("#c2-2").doTransition(1);
      $("#c4-2").doTransition(1);
    }, 150);

    setTimeout(() => {
      $("#c1-4").doTransition(1);
      $("#c4-3").doTransition(1);
      $("#c3-2").doTransition(1);
      $("#c2-4").doTransition(1);
    }, 200);

    setTimeout(() => {
      $("#c4-4").doTransition(1)
    }, 250);
  }, 1000);
</script>